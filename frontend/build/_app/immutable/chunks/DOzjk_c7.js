import{G as p}from"./DF-Dz73P.js";import{w as S}from"./DS_D3Oba.js";function f(){let t=null,e=null;{t=localStorage.getItem("token");const r=localStorage.getItem("user");try{r&&r!=="undefined"&&(e=JSON.parse(r))}catch(o){console.error("Failed to parse stored user:",o),localStorage.removeItem("user")}}const{subscribe:l,set:n,update:c}=S({token:t,user:e});return{subscribe:l,login:(r,o)=>{localStorage.setItem("token",r),localStorage.setItem("user",JSON.stringify(o)),n({token:r,user:o})},logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),n({token:null,user:null})}}}const g=f(),y="http://localhost:8000";async function s(t,e="GET",l=null){const n=p(g).token,c={"Content-Type":"application/json"};n&&(c.Authorization=`Bearer ${n}`);const r={method:e,headers:c};l&&(r.body=JSON.stringify(l));try{const o=await fetch(`${y}${t}`,r);let a;const u=await o.text();try{a=JSON.parse(u)}catch{console.warn(`[API] Response was not JSON: ${u.substring(0,100)}...`),a={error:u||o.statusText}}if(!o.ok){const i=new Error(a.error||"Request failed");throw i.code=a.code,i.details=a,i}return a}catch(o){throw console.error(`[API] ${e} ${t} failed:`,o),o}}const h={get:t=>s(t,"GET"),post:(t,e)=>s(t,"POST",e),patch:(t,e)=>s(t,"PATCH",e),getPlaylists:()=>s("/api/my/playlists"),getPublicPlaylists:()=>s("/playlists/public"),getPlaylist:t=>s(`/playlists/${t}`),importPlaylist:(t,e)=>s(`/api/playlists/${t}/import`,"POST",{platform:e}),getConnectionStatus:()=>s("/api/connection/status"),getSpotifyLink:()=>`${y}/api/link/spotify?token=${p(g).token}`,getYouTubeLink:()=>`${y}/api/link/youtube?token=${p(g).token}`};export{h as a,g as b};
